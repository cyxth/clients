var ie=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var a=(n,e,t)=>(ie(n,e,"read from private field"),t?t.call(n):e.get(n)),f=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},g=(n,e,t,r)=>(ie(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var b=(n,e,t)=>(ie(n,e,"access private method"),t);var h,L=new Array(128).fill(void 0);L.push(void 0,null,!0,!1);function A(n){return L[n]}var W=L.length;function Ce(n){n<132||(L[n]=W,W=n)}function U(n){let e=A(n);return Ce(n),e}var pe=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&pe.decode();var q=null;function Z(){return(q===null||q.byteLength===0)&&(q=new Uint8Array(h.memory.buffer)),q}function ge(n,e){return n=n>>>0,pe.decode(Z().subarray(n,n+e))}function m(n){W===L.length&&L.push(L.length+1);let e=W;return W=L[e],L[e]=n,e}function se(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){let i=n.length,s="[";i>0&&(s+=se(n[0]));for(let o=1;o<i;o++)s+=", "+se(n[o]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}var B=0,ee=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ve=typeof ee.encodeInto=="function"?function(n,e){return ee.encodeInto(n,e)}:function(n,e){let t=ee.encode(n);return e.set(t),{read:n.length,written:t.length}};function Se(n,e,t){if(t===void 0){let l=ee.encode(n),u=e(l.length,1)>>>0;return Z().subarray(u,u+l.length).set(l),B=l.length,u}let r=n.length,i=e(r,1)>>>0,s=Z(),o=0;for(;o<r;o++){let l=n.charCodeAt(o);if(l>127)break;s[i+o]=l}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3,1)>>>0;let l=Z().subarray(i+o,i+r),u=ve(n,l);o+=u.written,i=t(i,r,o,1)>>>0}return B=o,i}var K=null;function p(){return(K===null||K.byteLength===0)&&(K=new Int32Array(h.memory.buffer)),K}var M=null;function Pe(){return(M===null||M.byteLength===0)&&(M=new Uint32Array(h.memory.buffer)),M}function ke(n,e){let t=e(n.length*4,4)>>>0,r=Pe();for(let i=0;i<n.length;i++)r[t/4+i]=m(n[i]);return B=n.length,t}function Oe(n,e){try{return n.apply(this,e)}catch(t){h.__wbindgen_exn_store(m(t))}}var Re=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>h.__wbg_colab_free(n>>>0)),V=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,Re.unregister(this),e}free(){let e=this.__destroy_into_raw();h.__wbg_colab_free(e)}constructor(e){let t=h.colab_new(e);return this.__wbg_ptr=t>>>0,this}load(e){try{let i=h.__wbindgen_add_to_stack_pointer(-16);h.colab_load(i,this.__wbg_ptr,m(e));var t=p()[i/4+0],r=p()[i/4+1];if(r)throw U(t)}finally{h.__wbindgen_add_to_stack_pointer(16)}}change(e){try{let s=h.__wbindgen_add_to_stack_pointer(-16),o=ke(e,h.__wbindgen_malloc),l=B;h.colab_change(s,this.__wbg_ptr,o,l);var t=p()[s/4+0],r=p()[s/4+1],i=p()[s/4+2];if(i)throw U(r);return U(t)}finally{h.__wbindgen_add_to_stack_pointer(16)}}apply(e,t,r){try{let l=h.__wbindgen_add_to_stack_pointer(-16);h.colab_apply(l,this.__wbg_ptr,e,t,m(r));var i=p()[l/4+0],s=p()[l/4+1],o=p()[l/4+2];if(o)throw U(s);return U(i)}finally{h.__wbindgen_add_to_stack_pointer(16)}}value(){let e=h.colab_value(this.__wbg_ptr);return U(e)}cursor(){let e=h.colab_cursor(this.__wbg_ptr);return U(e)}patch(e){try{let s=h.__wbindgen_add_to_stack_pointer(-16);h.colab_patch(s,this.__wbg_ptr,m(e));var t=p()[s/4+0],r=p()[s/4+1],i=p()[s/4+2];if(i)throw U(r);return U(t)}finally{h.__wbindgen_add_to_stack_pointer(16)}}requested(e,t){try{let o=h.__wbindgen_add_to_stack_pointer(-16);h.colab_requested(o,this.__wbg_ptr,e,m(t));var r=p()[o/4+0],i=p()[o/4+1],s=p()[o/4+2];if(s)throw U(i);return U(r)}finally{h.__wbindgen_add_to_stack_pointer(16)}}};async function De(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function Ne(){let n={};return n.wbg={},n.wbg.__wbindgen_object_drop_ref=function(e){U(e)},n.wbg.__wbindgen_string_new=function(e,t){let r=ge(e,t);return m(r)},n.wbg.__wbindgen_number_new=function(e){return m(e)},n.wbg.__wbindgen_object_clone_ref=function(e){let t=A(e);return m(t)},n.wbg.__wbg_new_75208e29bddfd88c=function(){let e=new Array;return m(e)},n.wbg.__wbg_new_632630b5cec17f21=function(){let e=new Object;return m(e)},n.wbg.__wbg_push_0239ee92f127e807=function(e,t){return A(e).push(A(t))},n.wbg.__wbg_buffer_b914fb8b50ebbc3e=function(e){let t=A(e).buffer;return m(t)},n.wbg.__wbg_newwithbyteoffsetandlength_0de9ee56e9f6ee6e=function(e,t,r){let i=new Uint8Array(A(e),t>>>0,r>>>0);return m(i)},n.wbg.__wbg_new_b1f2d6842d615181=function(e){let t=new Uint8Array(A(e));return m(t)},n.wbg.__wbg_set_7d988c98e6ced92d=function(e,t,r){A(e).set(A(t),r>>>0)},n.wbg.__wbg_length_21c4b0ae73cba59d=function(e){return A(e).length},n.wbg.__wbg_set_961700853a212a39=function(){return Oe(function(e,t,r){return Reflect.set(A(e),A(t),A(r))},arguments)},n.wbg.__wbindgen_debug_string=function(e,t){let r=se(A(t)),i=Se(r,h.__wbindgen_malloc,h.__wbindgen_realloc),s=B;p()[e/4+1]=s,p()[e/4+0]=i},n.wbg.__wbindgen_throw=function(e,t){throw new Error(ge(e,t))},n.wbg.__wbindgen_memory=function(){let e=h.memory;return m(e)},n}function je(n,e){return h=n.exports,me.__wbindgen_wasm_module=e,K=null,M=null,q=null,h}async function me(n){if(h!==void 0)return h;typeof n>"u"&&(n=new URL("colab_wasm_bg.wasm",import.meta.url));let e=Ne();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await De(await n,e);return je(t,r)}var we=me;var Ae=(n,e)=>{if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t])return!1;return!0},$e=(n,e)=>Object.prototype.toString.call(n)==="[object "+e+"]",Ee=n=>$e(n,"Object");var qe=(n,e,t)=>{n.forEach((r,i)=>{let s=n[i+1],o=s!==void 0&&typeof s=="number"?[]:{};e[r]=e[r]===void 0?o:e[r],i===n.length-1&&(e[r]=t),e=e[r]})},xe=(n,e)=>{let{path:t,value:r,action:i}=n;return i==="listInsert"||i==="listUpdate"?t=t.slice(2):i==="update"&&(t=t.slice(1)),t.length?qe(t,e.value,r):e.value=r,e},oe=n=>{let e,t,r,i,s=[],o=[],l=[],u=()=>l[l.length-1],E=()=>{let y={action:e,key:s,path:[]};return y.path.push(...s),t!==void 0&&(y.index=t,y.path.push(t)),r!==void 0&&(y.count=r),y.path.push(...o),i!==void 0&&(y.value=i),y},x=()=>{let y=E(),N=()=>{if(e==="update"||e==="listUpdate"||e==="listInsert"){let $={action:e,key:s};return y.index!==void 0&&($.index=y.index),y.count!==void 0&&($.count=y.count),$.__p=!0,$.value={},$}else return y},k=u();k||(l.push(N()),k=u());let{__p:j,key:O,index:Le}=k;j&&(Ae(O,s)&&Le===t?xe(y,k):(l.push(N()),xe(y,u()))),e=void 0,t=void 0,r=void 0,i=void 0,s=[],o=[]},c=0;for(;c<n.length;)switch(n[c]){case 1:e||(e="update"),i=n[c+1],x(),c+=2;break;case 2:e||(e="delete"),x(),c+=2;break;case 0:e?o.push(n[c+1]):s.push(n[c+1]),c+=2;break;case 3:e?o.push(n[c+1]):(e="listInsert",t=n[c+1]),c+=2;break;case 4:e?o.push(n[c+1]):(e="listUpdate",t=n[c+1]),c+=2;break;case 5:e="listDelete",t=n[c+1],x(),c+=1;break;case 6:e="textInsert",s.push(n[c+1]),t=n[c+2],i=n[c+3],x(),c+=4;break;case 7:e="textDelete",s.push(n[c+1]),t=n[c+2],r=n[c+3],x(),c+=4;break;case 8:e=n[c+2]>0?"counterIncrement":"counterDecrement",s.push(n[c+1]),i=n[c+3],x(),c+=4;break}return l};var ae=class{constructor(){this.changes=[]}keyPath(e){if(typeof e=="string")return this.key(e);{let t=e.map(r=>this.key(r));return this.mergeArrays(t)}}key(e){let t=this.str(e),r=new Uint8Array(1+t.length);return r[0]=I.KEY,r.set(t,1),r}leaf(e){if(typeof e=="string"){let t=this.str(e),r=new Uint8Array(2+t.length);return r[0]=I.VALUE,r[1]=le.STRING,r.set(t,2),r}else{let t=new Uint8Array(10);return t[0]=I.VALUE,t[1]=le.NUMBER,new DataView(t.buffer).setFloat64(2,e,!1),t}}listOp(e,t=I.LIST_INSERT){let r=new Uint8Array(5);return r[0]=t,this.u32(r,1,e),r}str(e){let t=new TextEncoder().encode(e),r=new Uint8Array(4+t.byteLength);return this.u32(r,0,t.byteLength),r.set(t,4),r}u32(e,t,r,i=!1){let s=[255&r>>24,255&r>>16,255&r>>8,255&r];i&&s.reverse(),e.set(s,t)}mergeArrays(e){let t=e.reduce((s,o)=>s+=o.byteLength,0),r=new Uint8Array(t),i=0;return e.forEach(s=>{r.set(s,i),i+=s.length}),r}expandValue(e){if(Array.isArray(e)){let t=[];return e.forEach((r,i)=>{let s=this.expandValue(r);if(Array.isArray(s))s.forEach((o,l)=>{let u=l===0?this.listOp(i):this.listOp(i,I.LIST_UPDATE),E=new Uint8Array(u.byteLength+o.byteLength);E.set(u,0),E.set(o,u.byteLength),t.push(E)});else{let o=this.listOp(i),l=new Uint8Array(o.byteLength+s.byteLength);l.set(o,0),l.set(s,o.byteLength),t.push(l)}}),t}else if(Ee(e)){let t=[];return Object.entries(e).forEach(([r,i])=>{let s=this.key(r),o=this.expandValue(i);if(Array.isArray(o))o.forEach(l=>{let u=new Uint8Array(s.byteLength+l.byteLength);u.set(s,0),u.set(l,s.byteLength),t.push(u)});else{let l=new Uint8Array(s.byteLength+o.byteLength);l.set(s,0),l.set(o,s.byteLength),t.push(l)}}),t}else return this.leaf(e)}textInsert(e,t,r){let i=e.byteLength,s=this.str(r),o=new Uint8Array(1+i+4+s.byteLength);o[0]=I.TEXT_INSERT,o.set(e,1),this.u32(o,i+1,t),o.set(s,i+5),this.changes.push(o)}textRemove(e,t,r){let i=e.length,s=new Uint8Array(i+9);s[0]=I.TEXT_DELETE,s.set(e,1),this.u32(s,i+1,t),this.u32(s,i+5,r),this.changes.push(s)}counterOp(e,t){let r=e.byteLength,i=new Uint8Array(r+2);i[0]=I.COUNTER,i.set(e,1),i.set([t],r+1),this.changes.push(i)}},I=(u=>(u[u.KEY=0]="KEY",u[u.VALUE=1]="VALUE",u[u.DELETE=2]="DELETE",u[u.LIST_INSERT=3]="LIST_INSERT",u[u.LIST_UPDATE=4]="LIST_UPDATE",u[u.TEXT_INSERT=5]="TEXT_INSERT",u[u.TEXT_DELETE=6]="TEXT_DELETE",u[u.COUNTER=7]="COUNTER",u))(I||{}),le=(t=>(t[t.STRING=0]="STRING",t[t.NUMBER=1]="NUMBER",t))(le||{}),Ue=n=>{let e=0,t=new ae,r=new ue;for(;e<n.length;){let i=n[e],s=n[e-1];if(i===0){let o=t.keyPath(n[e+1]);r.set(o),e+=2}else if(i===4){let o=n[e+1],l=t.listOp(o,i);r.set(l),e+=2}else if(i===3){let o=n[e+1];if(n[e+2]===1){let E=t.expandValue(n[e+3]);if(Array.isArray(E)){let c=r.value();return E.reduce((y,N,k)=>{let j=k===0?t.listOp(o):t.listOp(o,4),O=new Uint8Array(c.byteLength+j.byteLength+N.byteLength);return O.set(c,0),O.set(j,c.byteLength),O.set(N,c.byteLength+j.byteLength),y.push(O),y},[])}let x=t.listOp(o,i);return r.set(x),r.set(E),[r.value()]}let u=t.listOp(o,i);r.set(u),e+=2}else if(i===1){let o=t.expandValue(n[e+1]);if(Array.isArray(o)){let l=r.value();return o.reduce((u,E)=>{let x=new Uint8Array(l.byteLength+E.byteLength);return x.set(l,0),x.set(E,l.byteLength),u.push(x),u},[])}return r.set(o),[r.value()]}else{if(i===2)return r.set([2]),[r.value()];if(i===5)return!s||Array.isArray(s)||e>3?{error:"access limited to single key"}:n[e+1]===void 0&&!n[e+2]?{error:"text index and value required"}:(t.textInsert(r.value(),n[e+1],n[e+2]),t.changes);if(i===6)return!s||Array.isArray(s)||e>3?{error:"access limited to single key"}:n[e+1]===void 0&&!n[e+2]?{error:"text index and delete length required"}:(t.textRemove(r.value(),n[e+1],n[e+2]),t.changes);if(i===7)return!s||Array.isArray(s)||e>3?{error:"access limited to single key"}:(t.counterOp(r.value(),n[e+1]),t.changes)}}return{error:"error parsing operation"}},S,C,R,te,Te,ue=class{constructor(){f(this,te);f(this,S,void 0);f(this,C,void 0);f(this,R,void 0);this.length=0,g(this,S,new Uint8Array),g(this,C,0),g(this,R,0)}set(e,t){t||(t=a(this,R)),t+e.length>=a(this,C)&&b(this,te,Te).call(this,t+e.length-a(this,C)),a(this,S).set(e,t),this.length+=e.length,g(this,R,t+e.length)}value(){return a(this,S).subarray(0,this.length)}};S=new WeakMap,C=new WeakMap,R=new WeakMap,te=new WeakSet,Te=function(e){let t=a(this,C)+a(this,C)/2+e;g(this,C,t);let r=new Uint8Array(t);r.set(a(this,S),0),g(this,S,r)};var v,_,X,P,F=class{constructor(e,t){f(this,v,void 0);f(this,_,void 0);f(this,X,void 0);f(this,P,void 0);g(this,X,e),g(this,P,t),g(this,v,[]),g(this,_,[0,a(this,P)])}key(e){return a(this,_).push(0,e),this}update(e){return a(this,_).push(1,e),this.build()}delete(){return a(this,_).push(2),this.build()}getList(e){let t=this,r=0;return{insert(i,s){return r===void 0&&i>0&&a(t,v).push({message:"insert index out of range",key:a(t,P),length:r,index:i}),a(t,_).push(3,i),e&&a(t,_).push(0,e),a(t,_).push(1,s),t.build()},delete(i){return(r===void 0||i>r)&&a(t,v).push({message:"update index out of range",key:a(t,P),length:r,index:i}),a(t,_).push(4,i),e&&a(t,_).push(0,e),a(t,_).push(2),t.build()},push(i){return this.insert(r===void 0?0:r,i)},pop(){return r!==void 0&&r>0?this.delete(r):(a(t,v).push({message:"list is empty",key:a(t,P),length:r}),t.build())},index(i,s=!1){let o=4;return s&&(o=3),a(t,_).push(o,i),e&&a(t,_).push(0,e),t}}}getText(){let e=this;return{insert(t,r){return a(e,_).push(5,t,r),e.build()},delete(t,r){return a(e,_).push(6,t,r),e.build()},value(){return new Promise((t,r)=>{t("")})}}}getCounter(){let e=this;return{___o(t){return a(e,_).push(7,t),e.build()},increment(){return this.___o(1)},decrement(){return this.___o(0)},value(){return new Promise((t,r)=>{t(0)})}}}__errors(){return a(this,v).length>0?a(this,v):null}build(){return new Promise((e,t)=>{let r=this.__errors();if(r!==null)return t(r);let i=Ue(a(this,_));if(!Array.isArray(i)&&i.error)return t(i);try{return a(this,X).__innerChange(i),e(!0)}catch(s){return t(s)}})}};v=new WeakMap,_=new WeakMap,X=new WeakMap,P=new WeakMap;var d,w,T,Y,he,D,ne,re,Ie,J,fe,z,de,G,ye,H,be,Q,_e,ce=class{constructor(e,t){f(this,Y);f(this,D);f(this,re);f(this,J);f(this,z);f(this,G);f(this,H);f(this,Q);f(this,d,void 0);f(this,w,void 0);f(this,T,void 0);g(this,d,e),g(this,T,{}),this.wasmUrl=t}async __loadWasm(){this.wasmUrl||console.log("wasm url is not set using default `colab.wasm`, ensure you serve it from your server");try{return await we(this.wasmUrl||"colab.wasm"),this}catch(e){throw{err:e,ctx:"error loading wasm binary"}}}async start(e,t,r){this.stateId=e;try{let{cid:i}=await a(this,d).cend(`sync:create~${e}`,{});g(this,w,new V(i)),r&&this.configure(r),b(this,J,fe).call(this)}catch(i){throw i}}async join(e){this.stateId=e;try{let t=await a(this,d).cend(`sync:join~${e}`,{});return b(this,Y,he).call(this,t)}catch(t){throw t}}async load(e){this.stateId=e;try{let t=await a(this,d).cend(`sync:load~${e}`,{});return b(this,Y,he).call(this,t)}catch(t){throw t}}presence(e){a(this,d).cend(`sync:live~${this.stateId}`,e,!1)}change(e){return new F(this,e)}__innerChange(e){try{if(a(this,w)===void 0)throw"colab is not instantiated";let t=a(this,w).change(e);t.defer?console.log("deffered local apply due to missing events"):a(this,d).cendBin(`sync:change~${this.stateId}`,t.event)}catch(t){throw t}}moderateUsers(e,t){e=typeof e=="string"?[e]:e;let r={ty:"moderate",data:{mode:b(this,H,be).call(this,t),users:e}};return b(this,D,ne).call(this,r)}removeUsers(e){e=typeof e=="string"?[e]:e;let t={ty:"remove",data:{users:e}};return b(this,D,ne).call(this,t)}addUsers(e){e=typeof e!="object"&&!Array.isArray(e)?[e]:e;let t={ty:"add",data:{users:e}};return b(this,D,ne).call(this,t)}async getUsers(e=!1){try{return(await a(this,d).cend(`sync:users~${this.stateId}`,e)).map(r=>(r.mode=b(this,Q,_e).call(this,r.mode),r))}catch(t){throw t}}on(e,t){a(this,T)[e]=t}delete(e){return a(this,d).cend(`sync:delete~${this.stateId}`,{reason:e})}configure(e,t=!0){let{defaultPermission:r,userEvents:i}=e;if(!r&&!i)return;let s=r?b(this,H,be).call(this,r):void 0,o=i?i.map(l=>l.replace("user:","")):void 0;return a(this,d).cend(`sync:config~${this.stateId}`,{default_mode:s,user_events:o,add:t})}static pluginId(){return"collab"}healthCheck(){}};d=new WeakMap,w=new WeakMap,T=new WeakMap,Y=new WeakSet,he=function(e){let t=new DataView(e.slice(0,4)).getUint32(0,!0);g(this,w,new V(t));let r=new Uint8Array(e.slice(4));return a(this,w).load(r),b(this,J,fe).call(this),a(this,w).value()},D=new WeakSet,ne=async function(e){try{let t=await a(this,d).cend(`sync:ctrl~${this.stateId}`,e);if(t.status)return t.status;throw t}catch(t){throw t}},re=new WeakSet,Ie=function(e){let t=new DataView(e),r=t.getBigInt64(0,!0),i=t.getUint32(8,!0),s=t.getUint8(12),o=new TextDecoder().decode(e.slice(13,13+s)),l=e.slice(13+s);return{eventId:r,seq:i,sender:o,payload:l}},J=new WeakSet,fe=function(){a(this,d).on(`sync:change~${this.stateId}`,async e=>{if(!a(this,w))return;let{eventId:t,seq:r,payload:i,sender:s}=b(this,re,Ie).call(this,e),o=a(this,w).apply(t,r,new Uint8Array(i));if(o.changes)b(this,z,de).call(this,o.changes,s);else if(o.cursor){console.log("detected missing events pulling");let{cursor:l,seq:u}=o;await b(this,G,ye).call(this,u,l,0)}else o.queued&&console.log("new event was queued due to missing events")}),a(this,d).on(`sync:stale~${this.stateId}`,e=>{if(!a(this,w))return;let t=new Uint8Array(e.slice(4));a(this,w).patch(t).forEach(i=>{a(this,T).change({changes:oe(i),userId:"_"})})}),a(this,d).on(`sync:live~${this.stateId}`,e=>{let t=a(this,T).presence;if(t){e=JSON.parse(e);try{let r=JSON.parse(e.data);t({userId:e.userId,data:r})}catch{t(e)}}else console.log("got presence but not handled")}),a(this,d).on(`sync:mode~${this.stateId}`,e=>{e=JSON.parse(e);let t=a(this,T)[`user:${e.action}`];if(t){let r={users:e.users,sender:e.sender};e.mode&&(r.mode=b(this,Q,_e).call(this,e.mode)),t(r)}}),a(this,d).on(`sync:delete~${this.stateId}`,e=>{e=JSON.parse(e);let t=a(this,T)["state:delete"];t&&t(e)}),a(this,d).on(`sync:config~${this.stateId}`,e=>{e=JSON.parse(e);let t=a(this,T)["state:configure"];t&&t(e)})},z=new WeakSet,de=function(e,t){let r=oe(e);a(this,T).change({changes:r,userId:t})},G=new WeakSet,ye=async function(e,t,r=0){if(r>=5){console.error("closed colab due to slow/bad connection");return}if(!a(this,w))return;let s=await a(this,d).cendBin(`sync:req~${this.stateId}`,t),o=new Uint8Array(s.slice(4)),l=a(this,w).requested(e,o);l.changes&&l.changes.forEach(u=>b(this,z,de).call(this,u,"_")),l.stale&&a(this,d).cendBin(`sync:stale~${this.stateId}`,l.stale).catch(u=>{}),l.cursor&&await b(this,G,ye).call(this,l.seq,l.cursor,r+=1)},H=new WeakSet,be=function(e){let t=0;switch(e){case"admin":t=7;case"editor":t=3;case"viewer":t=1;case"no-access":t=0}return t},Q=new WeakSet,_e=function(e){return e>3?"admin":e>1?"editor":e>0?"viewer":"no-access"};export{ce as default};
